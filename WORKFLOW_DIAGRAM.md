# Workflow Diagram: ATC Conflict Analysis System

## System Overview
This workflow diagram illustrates the complete process flow from SimBrief XML input to final visualization outputs.

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    ATC CONFLICT ANALYSIS WORKFLOW                                                                        │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    START                                                                                  │
│                                                                                                                                    │
│  ┌─────────────────┐                                                                                                                │
│  │   run_analysis.py│                                                                                                                │
│  │   Master Script │                                                                                                                │
│  └─────────────────┘                                                                                                                │
│           │                                                                                                                          │
│           ▼                                                                                                                          │
│  ┌─────────────────┐                                                                                                                │
│  │ Check Prerequisites│                                                                                                                │
│  │ • 16 XML files  │                                                                                                                │
│  │ • Scripts exist │                                                                                                                │
│  │ • Dirs created  │                                                                                                                │
│  └─────────────────┘                                                                                                                │
│           │                                                                                                                          │
│           ▼                                                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    STEP 1: XML EXTRACTION                                                                               │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                    simbrief_xml_flightplan_extractor.py                                                                           │  │
│  │                                                                                                                               │  │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                                    │  │
│  │  │ Parse XML   │───▶│ Extract     │───▶│ Generate    │───▶│ Save Flight │───▶│ Create KML  │                                    │  │
│  │  │ Files       │    │ Waypoints   │    │ Flight Data │    │ Data Files  │    │ Files       │                                    │  │
│  │  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘                                    │  │
│  │                                                                                                                               │  │
│  │  • Parse 16 XML files                                                                                                          │  │
│  │  • Extract coordinates, altitudes, times                                                                                       │  │
│  │  • Generate flight_plans.json                                                                                                  │  │
│  │  • Create individual KML files                                                                                                 │  │
│  │  • Save waypoint data                                                                                                          │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    OUTPUTS                                                                                        │  │
│  │  • flight_plans.json (flight data)                                                                                              │  │
│  │  • Individual KML files (16 files)                                                                                             │  │
│  │  • Waypoint coordinates and timing                                                                                              │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    STEP 2: CONFLICT ANALYSIS                                                                           │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                    analyze_and_report_conflicts.py                                                                                │  │
│  │                                                                                                                               │  │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                                    │  │
│  │  │ Load Flight │───▶│ Detect      │───▶│ Filter      │───▶│ Generate    │───▶│ Save        │                                    │  │
│  │  │ Plans       │    │ Conflicts   │    │ by Altitude │    │ Reports     │    │ Analysis    │                                    │  │
│  │  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘                                    │  │
│  │                                                                                                                               │  │
│  │  • Load flight_plans.json                                                                                                      │  │
│  │  • Calculate lateral separation (< 3 NM)                                                                                       │  │
│  │  • Calculate vertical separation (< 900 ft)                                                                                    │  │
│  │  • Filter conflicts above 5000 ft                                                                                              │  │
│  │  • Optimize departure times                                                                                                    │  │
│  │  • Generate conflict reports                                                                                                   │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    OUTPUTS                                                                                        │  │
│  │  • conflict_list.txt (2,704 bytes)                                                                                             │  │
│  │  • temp/conflict_analysis.json                                                                                                 │  │
│  │  • conflict_analysis.log                                                                                                        │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    STEP 3: KML MERGE                                                                                   │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                    merge_kml_flightplans.py                                                                                      │  │
│  │                                                                                                                               │  │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                                    │  │
│  │  │ Find KML    │───▶│ Parse KML   │───▶│ Merge       │───▶│ Add Conflict│───▶│ Save        │                                    │  │
│  │  │ Files       │    │ Files       │    │ Flight      │    │ Markers     │    │ Merged KML  │                                    │  │
│  │  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘                                    │  │
│  │                                                                                                                               │  │
│  │  • Scan for individual KML files                                                                                              │  │
│  │  • Parse each KML file                                                                                                        │  │
│  │  • Combine all flight paths                                                                                                   │  │
│  │  • Add conflict location markers                                                                                               │  │
│  │  • Create single merged KML file                                                                                              │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    OUTPUTS                                                                                        │  │
│  │  • merged_flightplans.kml (140,897 bytes)                                                                                     │  │
│  │  • Google Earth compatible visualization                                                                                       │  │
│  │  • Conflict markers at intersection points                                                                                     │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    STEP 4: SCHEDULING & PILOT BRIEFING                                                                       │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                    generate_schedule_conflicts.py                                                                                 │  │
│  │                                                                                                                               │  │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                                    │  │
│  │  │ Load        │───▶│ Calculate   │───▶│ Apply       │───▶│ Generate    │───▶│ Save        │                                    │  │
│  │  │ Conflicts   │    │ Departure   │    │ Separation   │    │ Schedule    │    │ CSV File    │                                    │  │
│  │  │ Data        │    │ Times       │    │ Rules       │    │ Timeline    │    │             │                                    │  │
│  │  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘                                    │  │
│  │                                                                                                                               │  │
│  │  • Load conflict analysis data                                                                                                │  │
│  │  • Calculate optimal departure times                                                                                           │  │
│  │  • Apply 2-minute separation rules                                                                                            │  │
│  │  • Generate event timeline                                                                                                     │  │
│  │  • Create departure schedule                                                                                                   │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    OUTPUTS                                                                                        │  │
│  │  • pilot_briefing.txt (5,427 bytes) - Pilot briefing (includes authoritative departure schedule and conflict details)                 │  │
│  │  • temp/conflict_analysis.json - Raw analysis data                                                                              │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    STEP 5: FRONTEND EXPORT                                                                             │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                    export_animation_data.py                                                                                       │  │
│  │                                                                                                                               │  │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                                    │  │
│  │  │ Load        │───▶│ Filter      │───▶│ Generate    │───▶│ Create      │───▶│ Save        │                                    │  │
│  │  │ Analysis    │    │ Conflicts   │    │ Flight      │    │ Animation   │    │ JSON Files  │                                    │  │
│  │  │ Data        │    │ by Altitude │    │ Tracks      │    │ Timeline    │    │             │                                    │  │
│  │  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘                                    │  │
│  │                                                                                                                               │  │
│  │  • Load conflict_analysis.json                                                                                                │  │
│  │  • Filter conflicts above 5000 ft                                                                                             │  │
│  │  • Extract waypoints from XML files                                                                                           │  │
│  │  • Generate flight track data                                                                                                 │  │
│  │  • Create animation timeline                                                                                                  │  │
│  │  • Export to web_visualization/                                                                                               │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    OUTPUTS                                                                                        │  │
│  │  • web_visualization/animation_data.json                                                                                       │  │
│  │  • web_visualization/flight_tracks.json                                                                                        │  │
│  │  • web_visualization/conflict_points.json                                                                                      │  │
│  │  • Ready for 3D web visualization                                                                                             │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    FINAL OUTPUTS                                                                                      │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    ANALYSIS REPORTS                                                                               │  │
│  │  • conflict_list.txt (2,704 bytes) - Detailed conflict analysis                                                                 │  │
│  │  • temp/conflict_analysis.json - Raw analysis data                                                                              │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    VISUALIZATION FILES                                                                             │  │
│  │  • merged_flightplans.kml (140,897 bytes) - Google Earth visualization                                                         │  │
│  │  • Individual KML files for each flight plan                                                                                    │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    FRONTEND DATA                                                                                  │  │
│  │  • web_visualization/animation_data.json - Complete animation data                                                              │  │
│  │  • web_visualization/flight_tracks.json - Individual flight paths                                                               │  │
│  │  • web_visualization/conflict_points.json - Conflict locations                                                                  │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    SCHEDULING DATA                                                                                │  │
│  │  • pilot_briefing.txt - Pilot briefing document (authoritative, includes schedule and conflicts)                                     │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    END                                                                                                │
│                                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    PERFORMANCE METRICS                                                                             │  │
│  │  • Total Processing Time: 0.9 seconds                                                                                           │  │
│  │  • Files Processed: 16 XML files                                                                                                │  │
│  │  • Conflicts Detected: Filtered by altitude > 5000 ft                                                                           │  │
│  │  • Output Files Generated: 6+ files                                                                                             │  │
│  │  • Error Rate: 0% (after Unicode cleanup)                                                                                       │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

## Decision Points and Quality Gates

### Quality Gates at Each Step:

1. **Prerequisites Check**
   - ✅ 16 XML files present
   - ✅ All scripts exist
   - ✅ Directories created

2. **XML Extraction**
   - ✅ All XML files parsed successfully
   - ✅ Waypoint data extracted
   - ✅ KML files generated

3. **Conflict Analysis**
   - ✅ Conflicts detected using thresholds
   - ✅ Altitude filtering applied (>5000 ft)
   - ✅ Reports generated

4. **KML Merge**
   - ✅ Individual KML files found
   - ✅ Files merged successfully
   - ✅ Conflict markers added

5. **Frontend Export**
   - ✅ Analysis data loaded
   - ✅ Conflicts filtered
   - ✅ JSON files created in web_visualization/

### Error Handling:
- Unicode/emoji characters removed from all scripts
- File existence checks at each step
- Graceful failure handling with error messages
- Logging of all operations with timestamps

### Success Criteria:
- Complete workflow execution without errors
- All output files generated with correct data
- Frontend visualization ready for use
- KML files compatible with Google Earth
- Animation data suitable for 3D web visualization 